# RapidOcrAndroidOnnxCompose

[![Issue](https://img.shields.io/github/issues/RapidAI/RapidOcrAndroidOnnxCompose.svg)](https://github.com/RapidAI/RapidOcrAndroidOnnxCompose/issues)
[![Star](https://img.shields.io/github/stars/RapidAI/RapidOcrAndroidOnnxCompose.svg)](https://github.com/RapidAI/RapidOcrAndroidOnnxCompose)

<details open>
    <summary>ç›®å½•</summary>

- [RapidOcrAndroidOnnxCompose](#RapidOcrAndroidOnnxCompose)
    - [è”ç³»æ–¹å¼](#è”ç³»æ–¹å¼)
    - [é¡¹ç›®å®Œæ•´æºç ](#é¡¹ç›®å®Œæ•´æºç )
    - [APKä¸‹è½½](#APKä¸‹è½½)
    - [ç®€ä»‹](#ç®€ä»‹)
    - [æ€»ä½“è¯´æ˜](#æ€»ä½“è¯´æ˜)
    - [æ›´æ–°è¯´æ˜](#æ›´æ–°è¯´æ˜)
    - [ç¼–è¯‘è¯´æ˜](#ç¼–è¯‘è¯´æ˜)
        - [ç¼–è¯‘ReleaseåŒ…](#ç¼–è¯‘ReleaseåŒ…)
    - [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
        - [è¾“å…¥å‚æ•°è¯´æ˜](#è¾“å…¥å‚æ•°è¯´æ˜)
    - [å…³äºä½œè€…](#å…³äºä½œè€…)
    - [ç‰ˆæƒå£°æ˜](#ç‰ˆæƒå£°æ˜)

</details>

## è”ç³»æ–¹å¼

[QQç¾¤](https://rapidai.github.io/RapidOCRDocs/main/communicate/#qq)

## é¡¹ç›®å®Œæ•´æºç 

* æ•´åˆå¥½æºç å’Œä¾èµ–åº“çš„å®Œæ•´å·¥ç¨‹é¡¹ç›®ï¼Œå¯åˆ°Qç¾¤å…±äº«å†…ä¸‹è½½æˆ–Releaseä¸‹è½½ï¼Œä»¥Projectå¼€å¤´çš„å‹ç¼©åŒ…æ–‡ä»¶ä¸ºæºç å·¥ç¨‹ï¼Œä¾‹ï¼šProject_RapidOcrAndroidOnnxCompose-ç‰ˆæœ¬å·.7z
* å¦‚æœæƒ³è‡ªå·±æŠ˜è…¾ï¼Œåˆ™è¯·ç»§ç»­é˜…è¯»æœ¬è¯´æ˜

## APKä¸‹è½½

* ç¼–è¯‘å¥½çš„demo apkï¼Œå¯ä»¥åœ¨releaseä¸­ä¸‹è½½ï¼Œæˆ–è€…Qç¾¤å…±äº«å†…ä¸‹è½½ï¼Œæ–‡ä»¶åä¾‹ï¼šRapidOcrAndroidOnnxCompose-ç‰ˆæœ¬å·-release.apk

## ç®€ä»‹

RapidOcr onnxruntimeæ¨ç† for Android

ä½¿ç”¨æŠ€æœ¯ï¼šjetpack compose + kotlin + åç¨‹

## ä¸»è¦ç‰¹æ€§

* âœ… **çº¯ Kotlin å®ç°**ï¼šå…¨éƒ¨ä½¿ç”¨ Kotlin ç¼–å†™ï¼Œæ— éœ€ C++ å’Œ JNI
* âœ… **å¤šç‰ˆæœ¬æ”¯æŒ**ï¼šæ”¯æŒ PP-OCR V3/V4/V5 ä¸‰ä¸ªç‰ˆæœ¬
* âœ… **çµæ´»é…ç½®**ï¼šæ”¯æŒè‡ªå®šä¹‰æ¨¡å‹è·¯å¾„å’ŒåŠ è½½ç­–ç•¥
* âœ… **æ˜“äºé›†æˆ**ï¼šæä¾› AAR åº“ï¼Œå¯ç›´æ¥é›†æˆåˆ°é¡¹ç›®
* âœ… **é«˜æ€§èƒ½**ï¼šåŸºäº ONNX Runtime æ¨ç†å¼•æ“
* âœ… **ç°ä»£åŒ–æ¶æ„**ï¼šJetpack Compose + Kotlin åç¨‹

## ä¸ä¹‹å‰çš„ç‰ˆæœ¬ä¸åŒç‚¹ï¼š

* RapidOcrAndroidOnnxçš„æ¨ç†ä»£ç ä½¿ç”¨C++ç¼–å†™ï¼Œå†é€šè¿‡JNIè°ƒç”¨
* RapidOcrAndroidOnnxComposeå…¨éƒ¨ä½¿ç”¨kotlinç¼–å†™

## ä¸»è¦ä½¿ç”¨çš„ä¾èµ–åº“ï¼š

* onnxruntime 1.19.2 [https://github.com/microsoft/onnxruntime](https://github.com/microsoft/onnxruntime)
* opencv 4.6.0 [https://github.com/opencv/opencv](https://github.com/opencv/opencv)

## æ›´æ–°è¯´æ˜

#### 2025-12-02 update 0.1.0

* âœ¨ **æ–°å¢é…ç½®ç³»ç»Ÿ**ï¼šæ”¯æŒè‡ªå®šä¹‰æ¨¡å‹è·¯å¾„å’ŒåŠ è½½ç­–ç•¥
* âœ¨ **å¤šç‰ˆæœ¬æ”¯æŒ**ï¼šæ”¯æŒ PP-OCR V3/V4/V5 ä¸‰ä¸ªç‰ˆæœ¬åˆ‡æ¢
* âœ¨ **çµæ´»é…ç½®**ï¼šå…¨å±€é…ç½® + å®ä¾‹çº§é…ç½®ï¼Œæ”¯æŒç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„
* âœ¨ **4 ç§åŠ è½½ç­–ç•¥**ï¼šFILE_FIRSTï¼ˆé»˜è®¤ï¼‰ã€ASSETS_FIRSTã€FILE_ONLYã€ASSETS_ONLY
* âœ¨ **Builder æ¨¡å¼ API**ï¼šç±»å‹å®‰å…¨ã€IDE å‹å¥½çš„é…ç½®æ¥å£
* âœ¨ **ä¸¥æ ¼æ¨¡å¼éªŒè¯**ï¼šå¯é€‰çš„è·¯å¾„é¢„éªŒè¯åŠŸèƒ½
* ğŸ“¦ å‡çº§ onnxruntime 1.13.1 â†’ 1.19.2ï¼ˆæ”¯æŒ PP-OCRv5ï¼‰
* ğŸ“– å®Œæ•´çš„ API æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
* âœ… å‘åå…¼å®¹ï¼Œç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹

#### 2022-11-12 update 0.0.1

* è·‘é€šå®Œæ•´è¯†åˆ«æµç¨‹
* opencv 4.6.0
* onnxruntime 1.13.1
* compose ui 1.3.1
* kotlin 1.7.10

## ç¼–è¯‘è¯´æ˜

1. AndroidStudio 2021.3.1æˆ–ä»¥ä¸Šï¼›
2. æ•´åˆå¥½çš„èŒƒä¾‹å·¥ç¨‹è‡ªå¸¦äº†æ¨¡å‹ï¼Œåœ¨OcrLibrary/src/main/assetsæ–‡ä»¶å¤¹ä¸­
3. ä¸‹è½½[opencv-4.6.0-android-sdk.zip](https://github.com/opencv/opencv/releases/tag/4.6.0)
   è§£å‹åç›®å½•ç»“æ„ä¸º

```
é¡¹ç›®æ ¹ç›®å½•/sdk
    â””â”€â”€ native
        â”œâ”€â”€ java
        â”œâ”€â”€ â€¦â€¦
        â””â”€â”€ native
```

### ç¼–è¯‘ReleaseåŒ…

* mac/linuxä½¿ç”¨å‘½ä»¤ç¼–è¯‘```./gradlew assembleRelease```
* winä½¿ç”¨å‘½ä»¤ç¼–è¯‘```gradlew.bat assembleRelease```
* è¾“å‡ºapkæ–‡ä»¶åœ¨app/build/outputs/apk

## å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€ä½¿ç”¨

```kotlin
// åˆ›å»º OCR å¼•æ“ï¼ˆä½¿ç”¨ V3 å†…ç½®æ¨¡å‹ï¼‰
val ocrEngine = OcrEngine(context, OcrModelVersion.V3)

// æ‰§è¡Œè¯†åˆ«
val result = ocrEngine.detect(
    bmp = bitmap,
    scaleUp = false,
    maxSideLen = 960,
    padding = 50,
    boxScoreThresh = 0.5f,
    boxThresh = 0.3f,
    unClipRatio = 1.6f,
    doCls = true,
    mostCls = false
)

// è·å–ç»“æœ
val text = result.text
val boxImage = result.boxImage

// é‡Šæ”¾èµ„æº
ocrEngine.close()
```

### 2. ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å‹è·¯å¾„

```kotlin
val config = OcrConfig.builder()
    .pathConfig {
        fromVersion("/sdcard/models", OcrModelVersion.V4)
    }
    .loadStrategy(OcrLoadStrategy.FILE_FIRST)
    .build()

val ocrEngine = OcrEngine(context, OcrModelVersion.V4, config)
```

### 3. è®¾ç½®å…¨å±€é…ç½®

```kotlin
// åœ¨ Application ä¸­
class App : Application() {
    override fun onCreate() {
        super.onCreate()

        val config = OcrConfig.builder()
            .pathConfig {
                fromVersion(filesDir.absolutePath + "/models", OcrModelVersion.V4)
            }
            .build()

        OcrConfigManager.setGlobalConfig(config)
    }
}

// åœ¨ Activity ä¸­ï¼ˆè‡ªåŠ¨ä½¿ç”¨å…¨å±€é…ç½®ï¼‰
val ocrEngine = OcrEngine(this, OcrModelVersion.V4)
```

## æ–‡æ¡£

* ğŸ“– [API å‚è€ƒæ–‡æ¡£](./doc/api-reference.md) - å®Œæ•´çš„ API è¯´æ˜å’Œä½¿ç”¨ç¤ºä¾‹
* ğŸš€ [å¿«é€Ÿå¼€å§‹æŒ‡å—](./doc/quick-start.md) - 5 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
* ğŸ¨ [é…ç½®ç³»ç»Ÿè®¾è®¡](./doc/ocr-config-design.md) - è¯¦ç»†çš„è®¾è®¡æ–‡æ¡£
* ğŸ“‹ [ç‰ˆæœ¬åˆ‡æ¢è®¡åˆ’](./doc/ocr-model-version-switch-plan.md) - å¤šç‰ˆæœ¬åˆ‡æ¢æ–¹æ¡ˆ

## AAR åº“

OcrLibrary å·²æ‰“åŒ…ä¸º AAR åº“ï¼Œå¯ç›´æ¥é›†æˆåˆ°é¡¹ç›®ï¼š

* **ä½ç½®**ï¼š`OcrLibrary/build/outputs/aar/`
* **æ–‡ä»¶**ï¼š
  - `OcrLibrary-0.1.0-debug.aar` (12MB)
  - `OcrLibrary-0.1.0-release.aar` (12MB)

### é›†æˆæ–¹å¼

```gradle
// 1. æ·»åŠ ä¾èµ–ä»“åº“
repositories {
    flatDir {
        dirs 'libs'
    }
}

// 2. æ·»åŠ ä¾èµ–
dependencies {
    implementation(name: 'OcrLibrary-0.1.0-release', ext: 'aar')

    // å¿…éœ€çš„ä¾èµ–
    implementation 'com.microsoft.onnxruntime:onnxruntime-android:1.19.2'
    implementation 'com.orhanobut:logger:2.2.0'
}
```

## å¸¸è§é—®é¢˜

### Q: APK ä½“ç§¯å¤§ï¼Ÿ

**A**: å› ä¸º opencv æ²¡æœ‰ç»è¿‡è£å‰ªï¼Œè¯·è‡ªè¡ŒæŠ˜è…¾ opencv è£å‰ªç¼–è¯‘ã€‚

### Q: å¦‚ä½•åˆ‡æ¢æ¨¡å‹ç‰ˆæœ¬ï¼Ÿ

**A**: å‚è§ [å¿«é€Ÿå¼€å§‹æŒ‡å—](./doc/quick-start.md) æˆ– [API æ–‡æ¡£](./doc/api-reference.md)ã€‚

### Q: æ”¯æŒå“ªäº›æ¨¡å‹ç‰ˆæœ¬ï¼Ÿ

**A**:
* **V3**ï¼šå†…ç½®åœ¨ assetsï¼Œå¼€ç®±å³ç”¨
* **V4**ï¼šéœ€è¦ä¸‹è½½ï¼Œæ”¯æŒæ›´é«˜ç²¾åº¦
* **V5**ï¼šéœ€è¦ä¸‹è½½ï¼Œæœ€æ–°ç‰ˆæœ¬

### Q: å¦‚ä½•è‡ªå®šä¹‰æ¨¡å‹è·¯å¾„ï¼Ÿ

**A**: ä½¿ç”¨é…ç½®ç³»ç»Ÿï¼š

```kotlin
val config = OcrConfig.builder()
    .pathConfig {
        detModelPath("/custom/det.onnx")
        recModelPath("/custom/rec.onnx")
    }
    .build()

val ocrEngine = OcrEngine(context, OcrModelVersion.V4, config)
```

æ›´å¤šé—®é¢˜è¯·æŸ¥çœ‹ [API æ–‡æ¡£ - å¸¸è§é—®é¢˜](./doc/api-reference.md#å¸¸è§é—®é¢˜)ã€‚

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¤ç”¨ OcrEngine å®ä¾‹**ï¼šåˆ›å»ºå’Œåˆå§‹åŒ–å¼€é”€è¾ƒå¤§ï¼Œåº”å°½é‡å¤ç”¨
2. **åœ¨åå°çº¿ç¨‹æ‰§è¡Œ**ï¼š`detect()` æ˜¯è€—æ—¶æ“ä½œï¼Œå¿…é¡»åœ¨åå°çº¿ç¨‹æ‰§è¡Œ
3. **è°ƒæ•´å›¾ç‰‡å°ºå¯¸**ï¼šæ ¹æ®éœ€æ±‚è°ƒæ•´ `maxSideLen`ï¼Œè¿‡å¤§ä¼šå½±å“æ€§èƒ½
4. **é€‰æ‹©åˆé€‚çš„æ¨¡å‹ç‰ˆæœ¬**ï¼šV3 æœ€å¿«ï¼ŒV4/V5 ç²¾åº¦æ›´é«˜ä½†æ›´æ…¢
5. **æŒ‰éœ€å¼€å¯åˆ†ç±»**ï¼šå¦‚æœç¡®å®šæ–‡å­—æ–¹å‘æ­£ç¡®ï¼Œå¯å…³é—­ `doCls`

## å…³äºä½œè€…

* Android demoç¼–å†™ï¼š[benjaminwan](https://github.com/benjaminwan)
* æ¨¡å‹æ¥è‡ªï¼š[PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR)

## ç‰ˆæƒå£°æ˜

- OCRæ¨¡å‹ç‰ˆæƒå½’[PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR)æ‰€æœ‰ï¼›
- å…¶å®ƒå·¥ç¨‹ä»£ç ç‰ˆæƒå½’æœ¬ä»“åº“æ‰€æœ‰è€…æ‰€æœ‰ï¼›

